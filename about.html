<!doctype html>
<html lang="en" prefix="og: http://ogp.me/ns#">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Bidibidi Refugee Settlement</title>
  <meta name="description" content="Bidibidi Refugee Settlement">
  <link rel="stylesheet" type='text/css' media='all' href="css/webslides.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" />
  <link rel="stylesheet" type="text/css" media="all" href="css/style_owen.css"> <!--owens css-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/c3/0.6.14/c3.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" media="all" href="css/style.css">
  <link rel="stylesheet" href="https://dc-js.github.io/dc.js/css/dc.min.css">
  <link rel="stylesheet" href="css/jqcloud.css">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css">
  <link href="https://fonts.googleapis.com/css?family=Alegreya+Sans+SC|Julius+Sans+One|Montserrat|Open+Sans&display=swap" rel="stylesheet">
  <style>
    #area {
      line-height: 12px;
      width: 280px;
      position: absolute;
      z-index: 1000;
      right: 10px;
      top: 0px;
      color: #a0a0a0;
      font-family: 'Alegreya Sans SC', sans-serif;
      padding: 6px 8px;
      background: #000000;
      background: rgba(38, 38, 38, 0.5);
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
      border-radius: 5px;
    }

    #area i {
      width: 25px;
      height: 16px;
      float: left;
      /* margin-right: 8px; */
      opacity: 0.7;
    }

    #area p {
      font-size: 12px;
      line-height: 16px;
      margin: 0;
    }

    a:link {
      color: black;
      background-color: transparent;
      text-decoration: none;
    }

    a:visited {
      color: #FF6600;
      background-color: transparent;
      text-decoration: none;
    }

    a:hover {
      color: black;
      background-color: transparent;
      text-decoration: underline;
    }

    a:active {
      color: orange;
      background-color: transparent;
      text-decoration: underline;
    }
    #info {
  position: fixed;
  z-index: 1000;
  top: 1px;
  right: 1px;
  width: 300px;
  color: white;
  padding: 6px 8px;
  background: transparent;
  box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
  border-radius: 5px;
  font-family: 'Alegreya Sans SC', sans-serif;
}

.info {
  padding: 6px 8px;
  font: 12px/14px;
  font-family: 'Alegreya Sans SC', sans-serif;
  background: white;
  background: rgba(255, 255, 255, 0.8);
  box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
  border-radius: 5px;
}
#info1 {
  position: fixed;
  z-index: 1000;
  bottom: 0px;
  right: 0px;
  width: 300px;
  color: white;
  padding: 6px 8px;
  background: black;
  box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
  border-radius: 5px;
  font-family: 'Alegreya Sans SC', sans-serif;
}

.info1 {
  padding: 6px 8px;
  font: 12px/14px;
  font-family: 'Alegreya Sans SC', sans-serif;
  background: white;
  box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
  border-radius: 5px;
}
h4 {
  font-family: 'Alegreya Sans SC', sans-serif;
  margin: 0 0 5px;
  color: #065581;
  font-size: 14px;
}

p {
  font-family: 'Alegreya Sans SC', sans-serif;
  margin: 0 0 5px;
  color: #065581;
  font-size: 20px;
}
.info h4 {
  font-family: 'Alegreya Sans SC', sans-serif;
  margin: 0 0 5px;
  color: #065581;
  font-size: 14px;
}
#chartword {
  position: absolute;
  left: 0;
  top: 20%;
  width: 100%;
  font-family: 'Alegreya Sans SC', sans-serif;
  color: white

}

#info2 {
position: absolute;
z-index: 1000;
bottom: 20px;
right: 0px;
width: 100%;
color: black;
padding: 6px 8px;
background: #EAEDED;
box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
font-family: 'Alegreya Sans SC', sans-serif;
}
#cloud {
  font-family: 'Alegreya Sans SC', sans-serif;
  text-shadow: 0 0 3px rgba(255, 255, 255, 0.5);
}
  </style>
  <link rel="shortcut icon" href="img/uganda.ico" type="image/x-icon">

  <!-- Javascript Library -->
  <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
  <script src="js/webslides.min.js"></script>
  <script src="js/jqcloud.js"></script>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  </body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.6.14/c3.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>
  <script type="text/javascript" src="js/chroma.js"></script>
  <script src="https://unpkg.com/leaflet-swoopy"></script>
  <script src="http://maximeh.github.io/leaflet.bouncemarker/bouncemarker.js"></script>
  <script src="https://unpkg.com/d3@5/dist/d3.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.6.14/c3.min.js"></script>
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://dc-js.github.io/dc.js/js/crossfilter.js"></script>
  <script src="https://dc-js.github.io/dc.js/js/dc.js"></script>
  <script src="js/leaflet-side-by-side.js"></script> <!--for the slide on satellite-->
  <script src="js/BubbleLayer.js"></script>

</head>



<body>

  <article id="webslides">
    <section class="bg-apple">
      <video class="background-video" autoplay muted loop>
        <source src="assets/bidibidi.mp4" type="video/mp4">
      </video>
      <div class="wrap aligncenter">
      </div>
    </section>
    <section class="fullscreen">
      <div class="card-60">
        <figure id="mymap2"></figure>
        <div class="flex-content" style="background: white">
          <h3>Historical information on South Sudan</h3>
        </div>
      </div>
    </section>
    <section class="fullscreen slide-bottom">
      <div id="mymap"></div>
      <div class="wrap">
        <div class="content-left">

        </div>
        <div class="content-right">
          <div class="info">
        <div id="chart"></div>
        </div>
      </div>
      </div>
    </section>
    <section class="fullscreen">
      <div id="mymap3"></div>


      <div class="wrap">
        <div class="content-left">
          <div class=info></div>
        </div>
      </div>
    </section>
    <!--satellite comparison 1-->
    <section class="bg-black">
      <div id="mysatellitemap"></div>
      <!-- <div class="content-left"> <h1>2016</h1> </div>
      <div class="content-right"> <h1>2018</h1> </div> -->
    </section>
    <!--satellite comparison 2-->
    <section class="bg-black">
      <div id="mysatellitemap2"></div>
        <!-- <div class="content-left"> <h1>2016</h1> </div> -->
    </section>
    <!-- <script src="js/main_owen.js"></script> -->

    <section class="fullscreen">
      <div class="wrap">
        <div class="card-50 bg-white">
          <div id="cloud"></div>
          <div class="flex-content">
            <span class="background" style="background-image:url('img/bidi.png')"></span>
            <figure id="chartword"></figure>
            <div id="info2" >
             <span class="alignleft"> <a href="https://www.instagram.com/explore/locations/1281867775213393/bidibidi-refugee-settlement-northern-uganda/" title="Instagram">
                  <img class="blacklogo" src="images/logos/instagram.svg" alt="Instagram">
                </a></span>
            <p>  <br><br>Hashtags used on geotagged photos, Bidibidi Refugee Settlement Camp. </p>
              <h5>Select a year of interest in graph : </h5> <p> Hashtags are weighted based off of their frequency in the year.  <br> Wordcloud reveals the changing sense of place<br> Y-axis Number of posts in the given year. </p><br><br>
          </div>
          </div>
        </div>
      </div>
      <!-- end .grid-->


    </section>

  </article>



  <script>
    var map = L.map("mymap", {
      zoomControl: false,
      scrollWheelZoom: false
    }).setView([3.1894481, 33.8365927], 7);

    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
      subdomains: 'abcd',
      maxZoom: 19
    }).addTo(map);


    L.geoJson.ajax("assets/southanduga.geojson", {

      style: function(feature) {
        switch (feature.properties.ADM0_EN) {
          case 'Uganda':
            return {
              color: "#00FF2A"
            };

        }
      }
    }).addTo(map);

    L.geoJson.ajax("assets/settlements.json", {
      onEachFeature: function(feature, layer) {
        layer.bindTooltip(feature.properties.name, {
          sticky: true,
          className: "feature-tooltip"
        });
      },
      style: function(feature) {
        switch (feature.properties.name) {
          case 'Bidi Bidi Refugee Settlement':
            return {
              color: "#FF00F6"
            };

        }
      }
    }).addTo(map);




    var map2 = L.map("mymap2", {
      zoomControl: false,
      scrollWheelZoom: false
    }).setView([4.3894481, 26.8365927], 5.5);

    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
      subdomains: 'abcd',
      maxZoom: 19
    }).addTo(map2);
    L.geoJson.ajax("assets/southanduga.geojson", {
      onEachFeature: function(feature, layer) {
        layer.bindTooltip(feature.properties.ADM0_EN, {
          sticky: true,
          className: "feature-tooltip"
        });
      },
      style: function(feature) {
        switch (feature.properties.ADM0_EN) {
          case 'Uganda':
            return {
              color: "#00FF2A"
            };
        }
      }
    }).addTo(map2);


    var conflict = L.icon({
      iconUrl: 'img/conflict.svg',
      iconSize: [25, 30], // size of the icon
    });

    L.marker([4.85, 31.6], {
      icon: conflict
    }).addTo(map2);
    L.marker([4.85, 31.6], {
      icon: conflict
    }).addTo(map);


    var map3 = L.map("mymap3", {
      zoomControl: false,
      scrollWheelZoom: false
    }).setView([3.3894481, 31.8365927], 7);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
      subdomains: 'abcd',
      maxZoom: 19
    }).addTo(map3);
    L.geoJson.ajax("assets/southanduga.geojson", {

      style: function(feature) {
        switch (feature.properties.ADM0_EN) {
          case 'Uganda':
            return {
              color: "#00FF2A"
            };
        }
      }
    }).addTo(map3);

    L.geoJson.ajax("assets/settlements.json", {
      onEachFeature: function(feature, layer) {
        layer.bindTooltip(feature.properties.name, {
          sticky: true,
          className: "feature-tooltip"
        });
      },
      style: function(feature) {
        switch (feature.properties.name) {
          case 'Bidi Bidi Refugee Settlement':
            return {
              color: "#FF00F6"
            };
        }
      }
    }).addTo(map3);
    var colors = chroma.scale('Dark2').mode('lch').colors(10);
for (i = 1; i < 11; i++) {
  $('html > head').append($("<style> .marker-icon-" + i.toString() + " { color: " + colors[i] + "; font-size: 15px; text-shadow: 0 0 3px #ffffff;} </style>"));
}


  var health = L.geoJson.ajax('assets/health.geojson', {
  pointToLayer: function(feature, latlng) {
      return L.marker(latlng, {
        icon: L.divIcon({
          html: '<i class="fas fa-clinic-medical"></i>',
          className: 'marker-icon-5'
        })
      });
    },
    onEachFeature: function(feature, layer) {
      layer.bindTooltip(feature.properties.name, {
        sticky: true,
        className: "feature-tooltip"
      });
    }
  }).addTo(map3);

  map3.on('click', function () {
  map3.removeLayer(health);
});


    var api = 'https://data2.unhcr.org/api/population/get/timeseries?widget_id=84726&geo_id=220&sv_id=5&population_group=5071&frequency=day&fromDate=1900-01-01';


    Promise.all([
      d3.csv('assets/pop.csv')
    ]).then(function(data) {
      var t = ["t"];
      var Migrate_Population = ["Migrate_Population"];

      data[0].forEach(function(d) {
        t.push(new Date(d["t"]));
        Migrate_Population.push(+d["Migrate_Population"]);
      });

      var chart = c3.generate({
        bindto: "#chart",
        title: {
          text: 'Migration from South Sudan'
        },
        data: {
          x: 't',
          columns: [t, Migrate_Population],
          type: 'spline',
        },
        axis: {
          x: {
            type: 'timeseries',
            tick: {
              format: '%Y'
            }
          },
          y: {
            label: {
              text: '# of Yearly Migration',
              position: 'outer-middle'
            }
          },
        },
      grid: {
          x: {
              lines: [{value: "2016-06-30", text: 'Volience in Juba'}]
          },
      },
        point: {
          r: 0,
          focus: {
            expand: {
              r: 2
            }
          }
        },
        stanford: {
          scaleMin: 1,
          scaleMax: 10000,
          scaleFormat: 'pow10',
          padding: {
            top: 15,
            right: 0,
            bottom: 0,
            left: 0
          }

        },
      });
    });

    //start code for satellite imagery
    var satelliteMap = L.map("mysatellitemap", {
      zoomControl: false,
      scrollWheelZoom: false
    }).setView([3.5199, 31.3300], 16);

    var satelliteMap2 = L.map("mysatellitemap2", {
      zoomControl: false,
      scrollWheelZoom: false
    }).setView([3.4667, 31.3743], 15);

    var presentTile = L.tileLayer('https://services.arcgisonline.com/arcgis/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {maxZoom: 19});
    var presentTile2 = L.tileLayer('https://services.arcgisonline.com/arcgis/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {maxZoom: 19});
    var pastTile = L.tileLayer('https://wayback.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/WMTS/1.0.0/default028mm/MapServer/tile/29387/{z}/{y}/{x}', {maxZoom: 19});
    var pastTile2 = L.tileLayer('https://wayback.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/WMTS/1.0.0/default028mm/MapServer/tile/29387/{z}/{y}/{x}', {maxZoom: 19});
    pastTile.addTo(satelliteMap);
    pastTile2.addTo(satelliteMap2);
    presentTile.addTo(satelliteMap);
    presentTile2.addTo(satelliteMap2);

    L.control.sideBySide(pastTile, presentTile).addTo(satelliteMap);
    L.control.sideBySide(pastTile2, presentTile2).addTo(satelliteMap2);
    //end code for satellite imagery


    function wordFrequency(txt, freq) {

      var wordArray = txt.split(/[ .?!,*'"”“]/);
      //var wordArray = txt.split(" ");
      var newArray = [],
        filteredArray = [],
        wordObj;
      wordArray.forEach(function(word) {
        wordObj = newArray.filter(function(w) {
          return w.text === word.toLowerCase();
        });
        if (wordObj.length) {
          wordObj[0].weight += 1;
        } else {
          newArray.push({
            text: word,
            weight: 1
          });
        }
      });

      var words = ["[]", ",", "[", "]", "", "][", "][][", "][][][", "][][][]["];

      newArray.filter(function(word) {
        if (!words.includes(word.text) && word.weight > freq) {
          filteredArray.push(word);
        }
      });

      return filteredArray;

    }


    colorscheme = chroma.scale('Dark2').colors(10).reverse();
    d3.csv('assets/locationbidiall.csv').then(function(data) {


      var filter = crossfilter(data);

      var all = filter.groupAll();

      var everything = filter.dimension(function(d) {
        return d
      });


      var dateDimension = filter.dimension(function(d) {

        return d.Year;
      });
      var dateDimensionGroup = dateDimension.group();


      var dateChart = dc.barChart('#chartword');
      dateChart
        .dimension(dateDimension)
        .group(dateDimensionGroup)
        .elasticY(true)
        .x(d3.scaleOrdinal()) //
        .xUnits(dc.units.ordinal)
        .yAxis()
        .ticks(3); //timeDate object that has the format for the date

      dc.renderAll();

      var texts = "";
      everything.top(Infinity).filter(function(d) {
        return texts += (" " + d.tags);
      });

      var frequencyList = null;
      frequencyList = wordFrequency(texts, 6);

      $("#cloud").jQCloud(frequencyList, {
        colors: colorscheme,
        autoResize: true,
        delay: 5,
        shape: 'rectangular',
        fontSize: {
          from: 0.1,
          to: 0.02
        }
      });



      dateChart.on('filtered', function(chartword, filter) {

        var texts = "";
        everything.top(Infinity).filter(function(d) {
          return texts += (" " + d.tags);
        });

        frequencyList = wordFrequency(texts, 2);
        $('#cloud').jQCloud('destroy');
        $("#cloud").jQCloud(frequencyList, {
          colors: colorscheme,
          autoResize: true,
          // steps: 20,
          delay: 5,
          shape: 'rectangular',
          fontSize: {
            from: 0.1,
            to: 0.02
          }
        });
        dc.renderAll();
      });
    });




    ws = new WebSlides();
    ws.el.addEventListener('ws:slide-change', function() {

      crtDiv = $(".current div");
      //Map 1 'flyto' animation location and function
      if (crtDiv.attr("id") === "mymap") {
        $.getJSON("assets/migration.geojson", function(migration) {


          for (let i = 0; i < migration.features.length; i++) {

            setTimeout(function() {
              lng = migration.features[i].geometry.coordinates[0];
              lat = migration.features[i].geometry.coordinates[1];

              L.swoopyArrow([4.85, 31.6], [lat, lng], {
                labelFontSize: 12,
                iconAnchor: [20, 10],
                iconSize: [30, 16],
                color: '#FF00F6',
                opacity: 0.7,
                weight: '2'
              }).addTo(map);
              // layergroup2.addLayer( L.marker([lat, lng], {icon: pwbIcon}));

            }, 400 * i);
          }


        });




      } else if (crtDiv.attr("id") === "mymap3") {
        map3.invalidateSize();
        //Fly to a new location.
        map3.flyTo([3.3963093129, 31.3759739178], 11, {
          animate: true,
          duration: 4
        });

      } else if (crtDiv.attr("id") === "mypop") {

      //new slide adjust for satellite 1 and 2
      }else if(crtDiv.attr("id") === "mysatellitemap"){
        satelliteMap.invalidateSize();
        satelliteMap.fitBounds([
          [3.5288, 31.3403],
          [3.5137, 31.3130]
        ]);
      }else if(crtDiv.attr("id") === "mysatellitemap2"){
        satelliteMap2.invalidateSize();
        satelliteMap2.fitBounds([
          [3.4503, 31.3421],
          [3.4843, 31.4071]
        ]);
      }
      //end slide adjust for satellite 1 and 2






    });
  </script>
</body>

</html>
